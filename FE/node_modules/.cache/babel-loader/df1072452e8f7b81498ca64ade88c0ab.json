{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/home/ich/MEGA/Entwicklung/FreeChess/repo/FreeChessRepo/FreeChess/FE/src/game/game.component.jsx\";\nimport React, { Component } from 'react';\nimport mainService from '../services/main.service';\nimport Canvas from '../components/canvas.component';\nimport PieceGenerator from '../components/generator/piece-generator';\nimport PieceCardComponent from './piece-card.component';\nimport Config from \"./config.json\";\nimport serverConfig from \"../services/server-config.json\";\n\nclass GameComponent extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      gameId: JSON.parse(localStorage.getItem(\"auth\")).gameId,\n      me: JSON.parse(localStorage.getItem(\"auth\")).player,\n      inviteLink: \"http://\" + serverConfig.host + \":3000/joingame/\" + JSON.parse(localStorage.getItem(\"auth\")).gameId,\n      //updater\n      isInited: false,\n      //game consts\n      player1: {},\n      player2: {},\n      width: 16,\n      height: 16,\n      pieces: {},\n      // images of pieces\n      // game state\n      boardData: {},\n      // data from server\n      boardView: {},\n      // symbol, playertype\n      turn: \"P1\",\n      round: 0,\n      winner: null,\n      //selection\n      selectedField: {},\n      possibleMoves: [],\n      pieceId: \"\"\n    };\n    this.selectField = this.selectField.bind(this);\n    this.clickOnCanvas = this.clickOnCanvas.bind(this);\n    this.drawMethod = this.drawMethod.bind(this);\n    this.play = this.play.bind(this);\n    this.loadBoard = this.loadBoard.bind(this);\n    this.loadPieceData = this.loadPieceData.bind(this);\n  }\n\n  componentDidMount() {\n    const {\n      isInited\n    } = this.state; //Init function \n\n    if (!isInited) {\n      this.loadPieceData();\n    } //start updater\n\n\n    const loadTimer = setInterval(() => {\n      this.updateGameData();\n    }, Config.updateInterval);\n  } //check for ugameupdate\n\n\n  updateGameData() {\n    const {\n      gameId,\n      turn\n    } = this.state;\n    mainService.getGameData(gameId).then(res => {\n      this.setState({\n        player1: res.data.player1,\n        player2: res.data.player2,\n        turn: res.data.turn,\n        round: res.data.round,\n        winner: res.data.winner\n      }); //when other player made his turn\n\n      if (turn !== res.data.turn) {\n        this.loadBoard();\n      } //check game end ?\n\n    });\n  } // initial creating piece graphics\n\n\n  loadPieceData() {\n    const {\n      gameId\n    } = this.state;\n    mainService.getBoard(gameId).then(res => {\n      let bv = this.createBoard(res.data.board);\n      var pieces = new Map();\n\n      for (let i = 0; i < bv.length; i++) {\n        for (let j = 0; j < bv[0].length; j++) {\n          if (bv[i][j].symbol !== \"\" && pieces.get(bv[i][j].symbol) === undefined) {\n            var pg = new PieceGenerator(Config.squareSize * 0.8, Config.squareSize * 0.95, bv[i][j].symbol);\n            pieces.set(bv[i][j].symbol, pg.drawPieceCanvas(bv[i][j].owner));\n          }\n        }\n      }\n\n      this.setState({\n        pieces: pieces,\n        isInited: true,\n        boardView: bv,\n        width: bv[0].length,\n        height: bv.length\n      });\n    });\n  } //update Board\n\n\n  loadBoard() {\n    const {\n      gameId\n    } = this.state;\n    mainService.getBoard(gameId).then(res => {\n      let bv = this.createBoard(res.data.board);\n      this.setState({\n        boardData: res.data,\n        boardView: bv,\n        width: bv[0].length,\n        height: bv.length\n      });\n    });\n  } // save Board data\n\n\n  createBoard(board) {\n    let bv = board;\n    console.log(bv);\n\n    for (let i = 0; i < bv.length; i++) {\n      for (let j = 0; j < bv[0].length; j++) {\n        if (board[i][j] === null) {\n          bv[i][j] = {\n            symbol: \"\",\n            owner: \"\",\n            possibleMoves: []\n          };\n        } else {\n          bv[i][j] = {\n            symbol: bv[i][j].symbol,\n            owner: bv[i][j].owner,\n            possibleMoves: bv[i][j].possibleMoves\n          };\n        }\n      }\n    }\n\n    return bv;\n  }\n\n  selectField(x, y) {\n    const {\n      boardView,\n      selectedField,\n      me,\n      turn,\n      possibleMoves\n    } = this.state;\n    const isPlayerTurn = me === turn;\n    const isEmptyField = boardView[y][x].symbol === \"\";\n    const sthSelected = JSON.stringify(selectedField) !== \"{}\";\n\n    if (sthSelected) {\n      const isAlreadySelected = selectedField.x === x && selectedField.y === y;\n      const isPossibleMove = possibleMoves.some(move => move.x === x && move.y === y);\n      const isOwnSelected = me === boardView[selectedField.y][selectedField.x].owner; // move,unselect, another select ?\n\n      if (isAlreadySelected) {\n        // unselect\n        this.setState({\n          possibleMoves: [],\n          selectedField: {},\n          pieceId: \"\"\n        });\n      } else if (isOwnSelected && isPossibleMove && isPlayerTurn) {\n        // move\n        const draw = {\n          fromPos: {\n            x: selectedField.x,\n            y: selectedField.y\n          },\n          toPos: {\n            x: x,\n            y: y\n          }\n        };\n        this.play(draw);\n      } else if (isEmptyField) {\n        // unselect\n        this.setState({\n          possibleMoves: [],\n          selectedField: {},\n          pieceId: \"\"\n        });\n      } else {\n        // select new position\n        this.setState({\n          possibleMoves: boardView[y][x].possibleMoves,\n          selectedField: {\n            x: x,\n            y: y\n          },\n          pieceId: boardView[y][x].symbol\n        });\n      }\n    } else {\n      if (!isEmptyField) {\n        // select new position\n        this.setState({\n          possibleMoves: boardView[y][x].possibleMoves,\n          selectedField: {\n            x: x,\n            y: y\n          },\n          pieceId: boardView[y][x].symbol\n        });\n      }\n    }\n  }\n\n  play(draw) {\n    const {\n      gameId,\n      turn,\n      winner\n    } = this.state;\n\n    if (winner === null) {\n      mainService.play(gameId, draw).then(res => {\n        //            console.log(\"played\", turn);\n        const nextTurn = turn === \"P1\" ? \"P2\" : \"P1\";\n        this.setState({\n          possibleMoves: [],\n          selectedField: {},\n          turn: nextTurn\n        });\n        this.updateGameData();\n        this.loadBoard();\n      });\n    }\n  }\n\n  clickOnCanvas(event) {\n    const rect = event.target.getBoundingClientRect();\n    const x = event.clientX - rect.left - Config.boardTopx;\n    const y = event.clientY - rect.top - Config.boardTopy;\n    this.selectField((x - x % Config.squareSize) / Config.squareSize, (y - y % Config.squareSize) / Config.squareSize);\n  }\n\n  drawMethod() {\n    const {\n      width,\n      height,\n      boardView,\n      possibleMoves,\n      selectedField,\n      me,\n      pieces,\n      isInited,\n      winner\n    } = this.state;\n\n    const draw = (ctx, frameCount) => {\n      if (boardView) {\n        const squareSize = Config.squareSize;\n        const boardTopx = Config.boardTopx;\n        const boardTopy = Config.boardTopy;\n        ctx.canvas.width = squareSize * (width + 1);\n        ctx.canvas.height = squareSize * (height + 1); //draw board\n\n        for (let i = 0; i < width; i++) {\n          for (let j = 0; j < height; j++) {\n            ctx.fillStyle = (i + j) % 2 === 0 ? \"#D2B48C\" : \"PeachPuff\";\n            let xOffset = boardTopx + j * squareSize;\n            let yOffset = boardTopy + i * squareSize;\n            ctx.fillRect(xOffset, yOffset, squareSize, squareSize);\n          }\n        }\n\n        if (JSON.stringify(selectedField) !== \"{}\") {\n          // draw moves\n          ctx.globalAlpha = 0.45;\n          ctx.fillStyle = me === boardView[selectedField.y][selectedField.x].owner ? \"lightgreen\" : \"red\";\n\n          for (let k = 0; k < possibleMoves.length; k++) {\n            let xOffset = boardTopx + possibleMoves[k].x * squareSize;\n            let yOffset = boardTopy + possibleMoves[k].y * squareSize;\n            ctx.fillRect(xOffset, yOffset, squareSize, squareSize);\n          } //draw selected\n\n\n          ctx.fillStyle = me === boardView[selectedField.y][selectedField.x].owner ? \"green\" : \"darkred\";\n          ctx.fillRect(boardTopx + selectedField.x * squareSize, boardTopy + selectedField.y * squareSize, squareSize, squareSize);\n          ctx.globalAlpha = 1;\n        } // draw pieces\n\n\n        if (boardView[0] && isInited) {\n          ctx.fillStyle = \"black\";\n          ctx.font = \"20px Arial\";\n\n          for (let i = 0; i < width; i++) {\n            for (let j = 0; j < height; j++) {\n              if (boardView[j][i].symbol !== \"\") {\n                let xOffset = boardTopx + (i + 0.115) * squareSize;\n                let yOffset = boardTopy + (j + 0.05) * squareSize;\n\n                if (pieces.length !== 0) {\n                  //  console.log(pieces);\n                  ctx.drawImage(pieces.get(boardView[j][i].symbol), xOffset, yOffset);\n                } //}\n\n              }\n            }\n          }\n        } // draw the border around the chessboard\n\n\n        ctx.strokeStyle = \"black\";\n        ctx.strokeRect(boardTopx, boardTopy, squareSize * width, squareSize * height); // draw winner\n\n        if (winner !== null) {\n          ctx.fillStyle = \"rgba(100,100,100,0.8)\";\n          ctx.fillRect(boardTopx, boardTopy, squareSize * width, squareSize * height);\n          ctx.fillStyle = \"red\";\n          ctx.font = '30px serif';\n          ctx.fillText(winner.name + ' wins!', squareSize * width / 3, squareSize * height / 2);\n        }\n      }\n    };\n\n    return draw;\n  }\n\n  drawGameText() {\n    const {\n      me,\n      turn\n    } = this.state;\n\n    if (me === turn) {\n      return \"Your turn!\";\n    }\n\n    return \"Wait for opponents turn...\";\n  }\n\n  render() {\n    const {\n      inviteLink,\n      player1,\n      player2,\n      round,\n      isInited,\n      winner\n    } = this.state; // console.log(\"pieceId (game component) :\", this.state.pieceId);\n\n    if (isInited) {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [this.drawGameText(), \" \", \" \", \" \", winner !== null && \"The Winner is\" + winner.name]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 317,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"row\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            class: \"mb-3 mt-5\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"card\",\n              children: this.state.pieceId !== \"\" && /*#__PURE__*/_jsxDEV(PieceCardComponent, {\n                pieceId: this.state.pieceId\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 321,\n                columnNumber: 63\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 320,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 319,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            class: \"mb-5\",\n            children: [/*#__PURE__*/_jsxDEV(Canvas, {\n              draw: this.drawMethod(),\n              onClick: this.clickOnCanvas\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 325,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: inviteLink\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 327,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [\"Player1: \", player1 && player1.name, \" \", player2 && /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: [\"Player2: \", player2.name]\n              }, void 0, true), \" \", \" round:\", round]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 328,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 324,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 318,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 316,\n        columnNumber: 17\n      }, this);\n    }\n\n    return \"\";\n  }\n\n}\n\nexport default GameComponent;","map":{"version":3,"sources":["/home/ich/MEGA/Entwicklung/FreeChess/repo/FreeChessRepo/FreeChess/FE/src/game/game.component.jsx"],"names":["React","Component","mainService","Canvas","PieceGenerator","PieceCardComponent","Config","serverConfig","GameComponent","constructor","props","state","gameId","JSON","parse","localStorage","getItem","me","player","inviteLink","host","isInited","player1","player2","width","height","pieces","boardData","boardView","turn","round","winner","selectedField","possibleMoves","pieceId","selectField","bind","clickOnCanvas","drawMethod","play","loadBoard","loadPieceData","componentDidMount","loadTimer","setInterval","updateGameData","updateInterval","getGameData","then","res","setState","data","getBoard","bv","createBoard","board","Map","i","length","j","symbol","get","undefined","pg","squareSize","set","drawPieceCanvas","owner","console","log","x","y","isPlayerTurn","isEmptyField","sthSelected","stringify","isAlreadySelected","isPossibleMove","some","move","isOwnSelected","draw","fromPos","toPos","nextTurn","event","rect","target","getBoundingClientRect","clientX","left","boardTopx","clientY","top","boardTopy","ctx","frameCount","canvas","fillStyle","xOffset","yOffset","fillRect","globalAlpha","k","font","drawImage","strokeStyle","strokeRect","fillText","name","drawGameText","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport mainService from '../services/main.service';\nimport Canvas from '../components/canvas.component';\nimport PieceGenerator from '../components/generator/piece-generator';\nimport PieceCardComponent from './piece-card.component';\nimport Config from \"./config.json\";\nimport serverConfig from \"../services/server-config.json\";\n\n\nclass GameComponent extends Component {\n\n    constructor(props) {\n        super(props)\n        this.state = {\n            gameId: JSON.parse(localStorage.getItem(\"auth\")).gameId,\n            me: JSON.parse(localStorage.getItem(\"auth\")).player,\n            inviteLink: \"http://\" + serverConfig.host + \":3000/joingame/\" + JSON.parse(localStorage.getItem(\"auth\")).gameId,\n\n            //updater\n            isInited: false,\n\n            //game consts\n            player1: {},\n            player2: {},\n            width: 16,\n            height: 16,\n            pieces: {}, // images of pieces\n\n            // game state\n            boardData: {}, // data from server\n            boardView: {}, // symbol, playertype\n            turn: \"P1\",\n            round: 0,\n            winner: null,\n\n            //selection\n            selectedField: {},\n            possibleMoves: [],\n            pieceId: \"\",\n        }\n        this.selectField = this.selectField.bind(this);\n        this.clickOnCanvas = this.clickOnCanvas.bind(this);\n        this.drawMethod = this.drawMethod.bind(this);\n        this.play = this.play.bind(this);\n        this.loadBoard = this.loadBoard.bind(this);\n        this.loadPieceData = this.loadPieceData.bind(this);\n\n    }\n\n    componentDidMount() {\n        const { isInited } = this.state;\n\n        //Init function \n        if (!isInited) {\n            this.loadPieceData();\n        }\n\n        //start updater\n        const loadTimer = setInterval(() => {\n            this.updateGameData();\n\n        }, Config.updateInterval);\n    }\n\n    //check for ugameupdate\n    updateGameData() {\n        const { gameId, turn } = this.state;\n        mainService.getGameData(gameId).then((res) => {\n\n\n\n            this.setState({ player1: res.data.player1, player2: res.data.player2, turn: res.data.turn, round: res.data.round, winner: res.data.winner });\n            //when other player made his turn\n            if (turn !== res.data.turn) {\n\n                this.loadBoard();\n            }\n\n            //check game end ?\n        });\n    }\n\n\n    // initial creating piece graphics\n    loadPieceData() {\n        const { gameId } = this.state;\n        mainService.getBoard(gameId).then((res) => {\n            let bv = this.createBoard(res.data.board);\n            var pieces = new Map();\n            for (let i = 0; i < bv.length; i++) {\n                for (let j = 0; j < bv[0].length; j++) {\n                    if (bv[i][j].symbol !== \"\" && pieces.get(bv[i][j].symbol) === undefined) {\n                        var pg = new PieceGenerator(Config.squareSize * 0.8, Config.squareSize * 0.95, bv[i][j].symbol);\n                        pieces.set(bv[i][j].symbol, pg.drawPieceCanvas(bv[i][j].owner));\n\n                    }\n                }\n            }\n\n            this.setState({ pieces: pieces, isInited: true, boardView: bv, width: bv[0].length, height: bv.length });\n        });\n    }\n\n    //update Board\n    loadBoard() {\n        const { gameId } = this.state;\n        mainService.getBoard(gameId).then((res) => {\n            let bv = this.createBoard(res.data.board);\n            this.setState({ boardData: res.data, boardView: bv, width: bv[0].length, height: bv.length });\n        });\n    }\n\n\n    // save Board data\n    createBoard(board) {\n        let bv = board;\n        console.log(bv);\n        for (let i = 0; i < bv.length; i++) {\n            for (let j = 0; j < bv[0].length; j++) {\n                if (board[i][j] === null) {\n                    bv[i][j] = {\n                        symbol: \"\",\n                        owner: \"\",\n                        possibleMoves: []\n                    };\n                } else {\n                    bv[i][j] = {\n                        symbol: bv[i][j].symbol,\n                        owner: bv[i][j].owner,\n                        possibleMoves: bv[i][j].possibleMoves\n                    };\n                }\n            }\n        }\n        return bv;\n    }\n\n\n    selectField(x, y) {\n        const { boardView, selectedField, me, turn, possibleMoves } = this.state;\n        const isPlayerTurn = me === turn;\n        const isEmptyField = boardView[y][x].symbol === \"\";\n        const sthSelected = JSON.stringify(selectedField) !== \"{}\";\n\n        if (sthSelected) {\n            const isAlreadySelected = selectedField.x === x && selectedField.y === y;\n            const isPossibleMove = possibleMoves.some(move => move.x === x && move.y === y);\n            const isOwnSelected = me === boardView[selectedField.y][selectedField.x].owner;\n\n            // move,unselect, another select ?\n\n            if (isAlreadySelected) {\n                // unselect\n                this.setState({\n                    possibleMoves: [],\n                    selectedField: {},\n                    pieceId: \"\"\n                });\n            } else if (isOwnSelected && isPossibleMove && isPlayerTurn) {\n                // move\n                const draw = { fromPos: { x: selectedField.x, y: selectedField.y }, toPos: { x: x, y: y } }\n                this.play(draw);\n            } else if (isEmptyField) {\n                // unselect\n                this.setState({\n                    possibleMoves: [],\n                    selectedField: {},\n                    pieceId: \"\"\n                });\n            } else {\n                // select new position\n                this.setState({\n                    possibleMoves: boardView[y][x].possibleMoves,\n                    selectedField: { x: x, y: y },\n                    pieceId: boardView[y][x].symbol\n                });\n            }\n        } else {\n            if (!isEmptyField) {\n                // select new position\n                this.setState({\n                    possibleMoves: boardView[y][x].possibleMoves,\n                    selectedField: { x: x, y: y },\n                    pieceId: boardView[y][x].symbol\n                });\n            }\n        }\n    }\n\n    play(draw) {\n        const { gameId, turn, winner } = this.state;\n        if (winner === null) {\n            mainService.play(gameId, draw).then((res) => {\n                //            console.log(\"played\", turn);\n                const nextTurn = (turn === \"P1\") ? \"P2\" : \"P1\";\n                this.setState({\n                    possibleMoves: [],\n                    selectedField: {},\n                    turn: nextTurn\n                });\n\n                this.updateGameData();\n                this.loadBoard();\n            });\n        }\n    }\n\n\n\n\n    clickOnCanvas(event) {\n        const rect = event.target.getBoundingClientRect();\n        const x = event.clientX - rect.left - Config.boardTopx;\n        const y = event.clientY - rect.top - Config.boardTopy;\n        this.selectField((x - x % Config.squareSize) / (Config.squareSize), (y - y % Config.squareSize) / (Config.squareSize));\n    }\n\n    drawMethod() {\n        const { width, height, boardView, possibleMoves, selectedField, me, pieces, isInited, winner } = this.state;\n\n\n        const draw = (ctx, frameCount) => {\n            if (boardView) {\n                const squareSize = Config.squareSize;\n                const boardTopx = Config.boardTopx;\n                const boardTopy = Config.boardTopy;\n\n                ctx.canvas.width = squareSize * (width + 1)\n                ctx.canvas.height = squareSize * (height + 1)\n\n                //draw board\n                for (let i = 0; i < width; i++) {\n                    for (let j = 0; j < height; j++) {\n                        ctx.fillStyle = ((i + j) % 2 === 0) ? \"#D2B48C\" : \"PeachPuff\";\n                        let xOffset = boardTopx + j * squareSize;\n                        let yOffset = boardTopy + i * squareSize;\n                        ctx.fillRect(xOffset, yOffset, squareSize, squareSize);\n                    }\n                }\n\n                if (JSON.stringify(selectedField) !== \"{}\") {\n                    // draw moves\n                    ctx.globalAlpha = 0.45;\n                    ctx.fillStyle = (me === boardView[selectedField.y][selectedField.x].owner) ? \"lightgreen\" : \"red\";\n                    for (let k = 0; k < possibleMoves.length; k++) {\n                        let xOffset = boardTopx + possibleMoves[k].x * squareSize;\n                        let yOffset = boardTopy + possibleMoves[k].y * squareSize;\n\n                        ctx.fillRect(xOffset, yOffset, squareSize, squareSize);\n                    }\n\n                    //draw selected\n                    ctx.fillStyle = (me === boardView[selectedField.y][selectedField.x].owner) ? \"green\" : \"darkred\";\n                    ctx.fillRect(boardTopx + selectedField.x * squareSize, boardTopy + selectedField.y * squareSize, squareSize, squareSize);\n                    ctx.globalAlpha = 1;\n                }\n\n                // draw pieces\n                if (boardView[0] && isInited) {\n                    ctx.fillStyle = \"black\";\n                    ctx.font = \"20px Arial\";\n                    for (let i = 0; i < width; i++) {\n                        for (let j = 0; j < height; j++) {\n                            if (boardView[j][i].symbol !== \"\") {\n\n                                let xOffset = boardTopx + (i + 0.115) * squareSize;\n                                let yOffset = boardTopy + (j + 0.05) * squareSize;\n                                if (pieces.length !== 0) {\n                                    //  console.log(pieces);\n\n                                    ctx.drawImage(pieces.get(boardView[j][i].symbol), xOffset, yOffset);\n                                }\n                                //}\n\n\n                            }\n                        }\n                    }\n                }\n\n                // draw the border around the chessboard\n                ctx.strokeStyle = \"black\";\n                ctx.strokeRect(boardTopx, boardTopy, squareSize * width, squareSize * height)\n\n\n                // draw winner\n                if (winner !== null) {\n                    ctx.fillStyle = \"rgba(100,100,100,0.8)\"\n                    ctx.fillRect(boardTopx, boardTopy, squareSize * width, squareSize * height)\n\n                    ctx.fillStyle = \"red\"\n                    ctx.font = '30px serif';\n                    ctx.fillText(winner.name + ' wins!', squareSize * width / 3, squareSize * height / 2);\n                }\n\n            }\n        }\n        return draw;\n\n    }\n\n    drawGameText() {\n        const { me, turn } = this.state;\n        if (me === turn) {\n            return \"Your turn!\";\n        }\n        return \"Wait for opponents turn...\";\n    }\n\n\n    render() {\n        const { inviteLink, player1, player2, round, isInited, winner } = this.state;\n        // console.log(\"pieceId (game component) :\", this.state.pieceId);\n        if (isInited) {\n            return (\n                <div>\n                    <div>{this.drawGameText()} {\" \"} {winner !== null && \"The Winner is\" + winner.name}</div>\n                    <div className=\"row\">\n                        <div class=\"mb-3 mt-5\">\n                            <div className=\"card\">\n                                {this.state.pieceId !== \"\" && <PieceCardComponent pieceId={this.state.pieceId}></PieceCardComponent>}\n                            </div>\n                        </div>\n                        <div class=\"mb-5\">\n                            <Canvas draw={this.drawMethod()} onClick={this.clickOnCanvas} />\n\n                            <div>{inviteLink}</div>\n                            <div>\n                                Player1: {player1 && player1.name} {player2 && <>Player2: {player2.name}</>} {\" round:\"}{round}\n                            </div>\n                        </div>\n                    </div >\n                </div>\n            )\n        }\n        return \"\";\n    }\n}\n\nexport default GameComponent"]},"metadata":{},"sourceType":"module"}